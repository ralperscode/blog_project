<%- include("partials/header") -%>
<div class="container compose-page-contents">
  <h1>Compose</h1>
  <form id="compose-form" action="/compose" method="post">
    <div class="form-group">
      <label for="title">Title</label>
      <input class="form-control" id="title" type="text" name="postTitle">
      <label for="editor">Post</label>
      <!-- Create the editor container -->
      <div class="quill-div">
        <div id="editor" style="height: 200px">
          <p><br></p>
        </div>
      </div>

      <input type="hidden" id="body" name="postBody" rows="3"></input>
      <input type="hidden" id="bodyText" name="postBodyText"></input>
    </div>
    <button class= "btn btn-primary" type="button" onClick="parseQuill()" name="composeButton">Publish</button>
  </form>
</div>

<script type="text/javascript">
  function parseQuill(){
    document.getElementById("body").value = encodeURIComponent(JSON.stringify(quill.getContents()));
    document.getElementById("bodyText").value = quill.getText();
    document.getElementById("compose-form").submit();
  }
  // works in as much as it creates the db entry
  // function parseQuill(){
  //   const delta = quill.getContents();
  //   document.getElementById("body").setAttribute("value", delta);
  //   document.getElementById("compose-form").submit();
  // }
</script>

<!-- Include the Quill library -->
<!-- pick one? -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>


<!-- Initialize Quill editor -->
<script>
  var FontAttributor = Quill.import('attributors/class/font');
FontAttributor.whitelist = [
  'libre-baskerville', 'pt-serif', 'playfair-display'
];
Quill.register(FontAttributor, true);

  var toolbarOptions = [
  // font options with defaults from theme. Custom size options
  [{ 'font': ['','libre-baskerville', 'pt-serif', 'playfair-display'] },{ 'size': ['small', false, 'large', 'huge'] }],
  // font color and highlight options with defaults from theme
  [{ 'color': [] }, { 'background': [] }],
  // font styling
  ['bold', 'italic', 'underline', 'strike'],
  // formatting
  [{ 'align': [] }],
  [{ 'list': 'ordered'}, { 'list': 'bullet' }],
  [{ 'script': 'sub'}, { 'script': 'super' }],
  [{ 'indent': '-1'}, { 'indent': '+1' }],
  // embed image or video
  ['image', 'video'],
  // quotes or code
  ['link','blockquote', 'code-block', 'code'],
  // optional header buttons and formatting
  [{ 'header': 1 }, { 'header': 2 },{ 'header': [1, 2, 3, 4, 5, 6, false] }],
  // invert text direction button
  [{ 'direction': 'rtl' }],
  // reset formatting button
  ['clean']
];

var quill = new Quill('#editor', {
  modules: {
    toolbar: toolbarOptions,
  },
  theme: 'snow',
  placeholder: "Write and format post here."
});
</script>

<%- include("partials/footer") -%>
